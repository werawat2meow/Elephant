generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * ---- Enums ----
 */
enum Role {
  MASTER_ADMIN
  ADMIN
  MANAGER
  USER
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

enum LeaveKind {
  ANNUAL          // Annual Leave
  SICK            // Sick Leave
  BUSINESS        // Personal/Business Leave
  UNPAID          // Leave without pay
  BIRTHDAY        // Birthday Leave
  ORDAIN          // Monkhood/Ordain
  MATERNITY       // Maternity Leave
  ANNUAL_HOLIDAY  // Annual Holiday Leave (‡∏•‡∏≤‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ)
  SHIFT_CHANGE    // Shift Change (‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå)
  HOLIDAY_CHANGE  // Holiday Change (‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå)
  OT              // OT (‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå)
}

enum LeaveSession {
  FULL   // ‡πÄ‡∏ï‡πá‡∏°‡∏ß‡∏±‡∏ô
  AM     // ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏ä‡πâ‡∏≤
  PM     // ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ö‡πà‡∏≤‡∏¢
}

/**
 * ---- Models ----
 */
model User {
  id           Int     @id @default(autoincrement())
  name         String?
  email        String  @unique
  passwordHash String
  role         Role    @default(USER)

  leaves    Leave[] // ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà user ‡∏ô‡∏µ‡πâ‡∏¢‡∏∑‡πà‡∏ô
  employee  Employee?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([role])
}

model Leave {
  id Int @id @default(autoincrement())

  // ‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠
  user   User @relation(fields: [userId], references: [id])
  userId Int

  // ‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á)
  approver   Approver? @relation(fields: [approverId], references: [id])
  approverId Int?

  // üîÅ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å type:String ‚Üí kind:LeaveKind
  kind       LeaveKind
  startDate  DateTime
  endDate    DateTime

  // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏ü‡∏≠‡∏£‡πå‡∏°
  session       LeaveSession?
  reason        String?
  approverReason    String?  // ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  approverSignature String?  // ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Base64 ‡∏´‡∏£‡∏∑‡∏≠ URL)
  contact       String?
  handoverTo    String?
  attachmentUrl String?

  // ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô "‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß" (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö .5)
  requestedDays Decimal @default(0.0) @db.Decimal(5,2)

  status     LeaveStatus @default(PENDING)
  approvedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([approverId])
  @@index([status, createdAt])
  @@index([kind, startDate, endDate]) // ‡∏ä‡πà‡∏ß‡∏¢ query ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ/‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
}
model Employee {
  id             Int       @id @default(autoincrement())
  empNo          String    @unique
  email          String?   @unique
  prefix         String?
  firstName      String
  lastName       String
  idCard         String?   @unique
  org            String? // ‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î
  department     String? // ‡πÅ‡∏ú‡∏ô‡∏Å
  division       String? // ‡∏ù‡πà‡∏≤‡∏¢
  unit           String? // ‡∏´‡∏ô‡πà‡∏ß‡∏¢
  levelP         String?
  lineId         String?
  startDate      DateTime?
  weeklyHoliday  String? // ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (‡πÄ‡∏ä‡πà‡∏ô "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå")
  // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏≤ (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ß‡∏±‡∏ô)
  vacationDays   Int       @default(0) // ‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô
  businessDays   Int       @default(0) // ‡∏•‡∏≤‡∏Å‡∏¥‡∏à
  sickDays       Int       @default(0) // ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢
  ordainDays     Int       @default(0) // ‡∏•‡∏≤‡∏ö‡∏ß‡∏ä
  maternityDays  Int       @default(0) // ‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î
  unpaidDays     Int       @default(0) // ‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á
  birthdayDays   Int       @default(0) // ‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î
  annualHolidays Int       @default(0) // ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ

  photoUrl String?

  // ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö user (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
  userId Int?  @unique
  user   User? @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([empNo])
}

model LeaveRight {
  id        Int      @id @default(autoincrement())
  level     String   @unique
  vacation  Int      @default(0)
  business  Int      @default(0)
  sick      Int      @default(0)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@index([level])
}

model Holiday {
  id         Int       @id @default(autoincrement())
  title      String    // ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î
  date       DateTime  // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÉ‡∏ä‡πâ only date)
  note       String?   // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@unique([date, title])           // ‡∏Å‡∏±‡∏ô‡∏ã‡πâ‡∏≥ (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
  @@index([date])
}


model Approver {
  id          Int      @id @default(autoincrement())
  prefix      String?
  firstNameTh String
  lastNameTh  String
  firstNameEn String?
  lastNameEn  String?
  empNo       String   @unique
  citizenId   String?  @unique
  org         String?
  department  String?
  division    String?
  unit        String?
  level       String?
  lineId      String?
  email       String?  @unique   // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á User

  // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° relation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Leave records ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  approvedLeaves Leave[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
