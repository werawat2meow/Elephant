generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * ---- Enums ----
 */
enum Role {
  MASTER_ADMIN
  ADMIN
  MANAGER
  USER
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

/**
 * ---- Models ----
 */
model User {
  id           Int     @id @default(autoincrement())
  name         String?
  email        String  @unique
  passwordHash String
  role         Role    @default(USER)

  leaves    Leave[] // คำขอที่ user นี้ยื่น
  approvals Leave[]   @relation("ApproverRequests") // คำขอที่ user นี้เป็นผู้อนุมัติ
  employee  Employee?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([role])
}

model Leave {
  id Int @id @default(autoincrement())

  // ผู้ยื่นคำขอ
  user   User @relation(fields: [userId], references: [id])
  userId Int

  // ผู้อนุมัติ (อาจยังว่าง)
  approver   User? @relation("ApproverRequests", fields: [approverId], references: [id])
  approverId Int?

  type      String // ภายหลังอยากทำ enum ก็ได้
  startDate DateTime
  endDate   DateTime
  reason    String?

  status     LeaveStatus @default(PENDING)
  approvedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([approverId])
  @@index([status, createdAt])
}

model Employee {
  id             Int       @id @default(autoincrement())
  empNo          String    @unique
  email          String?   @unique
  prefix         String?
  firstName      String
  lastName       String
  idCard         String?   @unique
  org            String? // สังกัด
  department     String? // แผนก
  division       String? // ฝ่าย
  unit           String? // หน่วย
  levelP         String?
  lineId         String?
  startDate      DateTime?
  weeklyHoliday  String? // วันหยุดประจำสัปดาห์ (เช่น "อาทิตย์")
  // สิทธิ์ลา (ตัวเลขวัน)
  vacationDays   Int       @default(0) // ลาพักร้อน
  businessDays   Int       @default(0) // ลากิจ
  sickDays       Int       @default(0) // ลาป่วย
  ordainDays     Int       @default(0) // ลาบวช
  maternityDays  Int       @default(0) // ลาคลอด
  unpaidDays     Int       @default(0) // ลาไม่รับค่าจ้าง
  birthdayDays   Int       @default(0) // ลาวันเกิด
  annualHolidays Int       @default(0) // วันหยุดประจำปี

  photoUrl String?

  // ผูกกับ user (ถ้าต้องการ)
  userId Int?  @unique
  user   User? @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([empNo])
}

model LeaveRight {
  id        Int      @id @default(autoincrement())
  level     String   @unique
  vacation  Int      @default(0)
  business  Int      @default(0)
  sick      Int      @default(0)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@index([level])
}

model Holiday {
  id         Int       @id @default(autoincrement())
  title      String    // ชื่อวันหยุด
  date       DateTime  // วันที่ (ใช้ only date)
  note       String?   // หมายเหตุ

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@unique([date, title])           // กันซ้ำ (ถ้าต้องการ)
  @@index([date])
}


model Approver {
  id         Int      @id @default(autoincrement())
  prefix     String?           // คำนำหน้าชื่อ
  firstNameTh String
  lastNameTh  String
  firstNameEn String?          // ถ้าอยากเก็บภาษาอังกฤษด้วย
  lastNameEn  String?
  empNo      String   @unique  // รหัสพนักงาน (unique)
  citizenId  String?  @unique  // บัตรประชาชน (ถ้าจะ unique)
  org        String?           // สังกัด
  department String?           // แผนก
  division   String?           // ฝ่าย
  unit       String?           // หน่วย
  level      String?           // Level P
  lineId     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
